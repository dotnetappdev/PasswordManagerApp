@using PasswordManager.Components.Shared.Components.Database

<DatabaseStartupWrapper OnConfigurationComplete="OnDatabaseConfigured">
    <Router AppAssembly="@typeof(MauiProgram).Assembly" 
            AdditionalAssemblies="new[] { typeof(PasswordManager.Components.Shared._Imports).Assembly }">
        <Found Context="routeData">
            <RouteView RouteData="@routeData" DefaultLayout="@typeof(Layout.MainLayout)" />
            <FocusOnNavigate RouteData="@routeData" Selector="h1" />
        </Found>
        <NotFound>
            <PageTitle>Not Found</PageTitle>
            <div class="not-found-message">
                <p>Page not found. Redirecting to login...</p>
            </div>
        </NotFound>
    </Router>
</DatabaseStartupWrapper>

@code {
    [Inject] 
    private NavigationManager NavigationManager { get; set; } = default!;
    
    private bool isDatabaseConfigured = false;
    
    protected override void OnInitialized()
    {
        // Initial navigation will be handled after database configuration
    }
    
    private void OnDatabaseConfigured()
    {
        isDatabaseConfigured = true;
        
        // Redirect to login page when database is configured and app starts
        if (NavigationManager.Uri.EndsWith("/"))
        {
            NavigationManager.NavigateTo("/login", true);
        }
        
        StateHasChanged();
    }
}


