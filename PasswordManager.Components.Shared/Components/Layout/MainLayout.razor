@inherits LayoutComponentBase
@using MudBlazor
@inject IJSRuntime JSRuntime
@inject NavigationManager Navigation

<MudThemeProvider Theme="@_theme" IsDarkMode="true" />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Color="Color.Dark" Fixed="true" Dense="true">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@ToggleDrawer" />
        <MudText Typo="Typo.h6" Style="color: white;">Password Manager</MudText>
        <MudSpacer />
        <MudMenu>
            <ActivatorContent>
                <MudIconButton Icon="@Icons.Material.Filled.AccountCircle" Color="Color.Inherit" />
            </ActivatorContent>
            <ChildContent>
                <MudMenuItem OnClick="NavigateToProfile">
                    <MudIcon Icon="@Icons.Material.Filled.Person" />
                    Profile
                </MudMenuItem>
                <MudMenuItem OnClick="NavigateToSettings">
                    <MudIcon Icon="@Icons.Material.Filled.Settings" />
                    Settings
                </MudMenuItem>
                <MudDivider />
                <MudMenuItem OnClick="Logout">
                    <MudIcon Icon="@Icons.Material.Filled.Logout" />
                    Logout
                </MudMenuItem>
            </ChildContent>
        </MudMenu>
    </MudAppBar>

    <MudDrawer @bind-Open="@_drawerOpen" ClipMode="DrawerClipMode.Always" Elevation="2" Color="Color.Dark">
        <MudDrawerHeader>
            <MudText Typo="Typo.h6" Style="color: white;">
                <MudIcon Icon="@Icons.Material.Filled.Security" Size="Size.Small" Style="margin-right: 8px;" />
                Password Manager
            </MudText>
        </MudDrawerHeader>
        <MudNavMenu>
            <MudNavLink Href="/vault" Icon="@Icons.Material.Filled.Security" IconColor="Color.Primary">
                Vault
            </MudNavLink>
            <MudNavLink Href="/passwords" Icon="@Icons.Material.Filled.Password" IconColor="Color.Primary">
                Passwords
            </MudNavLink>
            <MudNavLink Href="/credit-cards" Icon="@Icons.Material.Filled.CreditCard" IconColor="Color.Primary">
                Credit Cards
            </MudNavLink>
            <MudNavLink Href="/secure-notes" Icon="@Icons.Material.Filled.Note" IconColor="Color.Primary">
                Secure Notes
            </MudNavLink>
            <MudNavLink Href="/wifi" Icon="@Icons.Material.Filled.Wifi" IconColor="Color.Primary">
                Wi-Fi
            </MudNavLink>
            <MudDivider />
            <MudNavLink Href="/categories" Icon="@Icons.Material.Filled.Category" IconColor="Color.Secondary">
                Categories
            </MudNavLink>
            <MudNavLink Href="/collections" Icon="@Icons.Material.Filled.Folder" IconColor="Color.Secondary">
                Collections
            </MudNavLink>
            <MudNavLink Href="/tags" Icon="@Icons.Material.Filled.Tag" IconColor="Color.Secondary">
                Tags
            </MudNavLink>
            <MudDivider />
            <MudNavLink Href="/import" Icon="@Icons.Material.Filled.Upload" IconColor="Color.Info">
                Import
            </MudNavLink>
            <MudNavLink Href="/export" Icon="@Icons.Material.Filled.Download" IconColor="Color.Info">
                Export
            </MudNavLink>
            <MudSpacer />
            <MudNavLink Href="/settings" Icon="@Icons.Material.Filled.Settings" IconColor="Color.Warning">
                Settings
            </MudNavLink>
        </MudNavMenu>
    </MudDrawer>

    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.False" Style="background-color: #121212; min-height: 100vh; padding-top: 64px;">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

@code {
    private bool _drawerOpen = true;
    private MudTheme _theme = new()
    {
        PaletteDark = new PaletteDark()
        {
            Black = "#121212",
            Background = "#121212",
            BackgroundGrey = "#1e1e1e",
            Surface = "#1e1e1e",
            DrawerBackground = "#1e1e1e",
            DrawerText = "rgba(255,255,255, 0.87)",
            DrawerIcon = "rgba(255,255,255, 0.87)",
            AppbarBackground = "#1e1e1e",
            AppbarText = "rgba(255,255,255, 0.87)",
            TextPrimary = "rgba(255,255,255, 0.87)",
            TextSecondary = "rgba(255,255,255, 0.60)",
            ActionDefault = "#adadb1",
            ActionDisabled = "rgba(255,255,255, 0.26)",
            ActionDisabledBackground = "rgba(255,255,255, 0.12)",
            Divider = "rgba(255,255,255, 0.12)",
            DividerLight = "rgba(255,255,255, 0.06)",
            TableLines = "rgba(255,255,255, 0.12)",
            LinesDefault = "rgba(255,255,255, 0.12)",
            LinesInputs = "rgba(255,255,255, 0.3)",
            TextDisabled = "rgba(255,255,255, 0.2)",
            Primary = "#bb86fc",
            Secondary = "#03dac6",
            Tertiary = "#cf6679",
            Info = "#2196f3",
            Success = "#4caf50",
            Warning = "#ff9800",
            Error = "#f44336"
        }
    };

    private void ToggleDrawer()
    {
        _drawerOpen = !_drawerOpen;
    }

    private void NavigateToProfile()
    {
        Navigation.NavigateTo("/profile");
    }

    private void NavigateToSettings()
    {
        Navigation.NavigateTo("/settings");
    }

    private async Task Logout()
    {
        // Implement logout logic
        Navigation.NavigateTo("/masterpassword");
    }
}
